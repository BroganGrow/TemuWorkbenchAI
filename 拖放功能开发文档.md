# æ–‡ä»¶æ‹–æ”¾åŠŸèƒ½å¼€å‘æ–‡æ¡£

## ğŸ“¦ å·²å®Œæˆçš„æ–‡ä»¶æ¸…å•

### âœ… æ ¸å¿ƒåŠŸèƒ½æ–‡ä»¶

#### 1. ç±»å‹å®šä¹‰
- **src/types/index.ts** - TypeScript ç±»å‹å®šä¹‰
  - `DroppedFile` - æ‹–æ”¾æ–‡ä»¶ä¿¡æ¯æ¥å£
  - `ImportResult` - å¯¼å…¥ç»“æœæ¥å£
  - `FileInfo` - æ–‡ä»¶è¯¦ç»†ä¿¡æ¯æ¥å£
  - `Window` å…¨å±€æ¥å£æ‰©å±•

#### 2. React Hooks
- **src/hooks/useFileDrop.ts** - æ‹–æ”¾åŠŸèƒ½ Hook
  - æ‹–æ”¾çŠ¶æ€ç®¡ç†
  - æ–‡ä»¶æ ¼å¼éªŒè¯
  - æ–‡ä»¶åˆ—è¡¨ç®¡ç†
  - å·¥å…·å‡½æ•°ï¼ˆformatFileSizeï¼‰

#### 3. UI ç»„ä»¶
- **src/components/DropZone.tsx** - æ‹–æ”¾åŒºåŸŸç»„ä»¶
  - æ‹–æ”¾åŒºåŸŸï¼ˆå¸¦è§†è§‰åé¦ˆï¼‰
  - æ–‡ä»¶åˆ—è¡¨å±•ç¤º
  - ç›®æ ‡æ–‡ä»¶å¤¹é€‰æ‹©
  - å¯¼å…¥è¿›åº¦æ˜¾ç¤º
  - å¯¼å…¥ç»“æœå¯¹è¯æ¡†

#### 4. Electron ä¸»è¿›ç¨‹
- **electron/ipc-handlers.ts** - IPC é€šä¿¡å¤„ç†å™¨
  - `import-files` - å¯¼å…¥æ–‡ä»¶åˆ°ç›®æ ‡æ–‡ä»¶å¤¹
  - `select-folder` - æ‰“å¼€æ–‡ä»¶å¤¹é€‰æ‹©å¯¹è¯æ¡†
  - `list-files` - åˆ—å‡ºæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶
  - `create-directory` - åˆ›å»ºç›®å½•
  - `delete-file` - åˆ é™¤æ–‡ä»¶

#### 5. Electron é¢„åŠ è½½è„šæœ¬
- **electron/preload.ts** - æ›´æ–°ç‰ˆï¼ˆæ·»åŠ æ–° APIï¼‰
  - `importFiles()` - å¯¼å…¥æ–‡ä»¶ API
  - `selectFolder()` - é€‰æ‹©æ–‡ä»¶å¤¹ API
  - `listFiles()` - åˆ—å‡ºæ–‡ä»¶ API
  - `createDirectory()` - åˆ›å»ºç›®å½• API
  - `deleteFile()` - åˆ é™¤æ–‡ä»¶ API

#### 6. Electron ä¸»è¿›ç¨‹å…¥å£
- **electron/main.ts** - æ›´æ–°ç‰ˆï¼ˆæ³¨å†Œ IPC å¤„ç†å™¨ï¼‰
  - å¯¼å…¥ `registerIpcHandlers`
  - åœ¨ `app.whenReady()` ä¸­è°ƒç”¨

#### 7. ä¸»åº”ç”¨ç»„ä»¶
- **src/App.tsx** - æ›´æ–°ç‰ˆï¼ˆé›†æˆ DropZoneï¼‰
  - èœå•åˆ‡æ¢åŠŸèƒ½
  - é¡µé¢è·¯ç”±é€»è¾‘
  - DropZone ç»„ä»¶é›†æˆ

### ğŸ“š æ–‡æ¡£æ–‡ä»¶

- **ä½¿ç”¨è¯´æ˜.md** - ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ
- **æµ‹è¯•æŒ‡å—.md** - åŠŸèƒ½æµ‹è¯•æŒ‡å—
- **æ‹–æ”¾åŠŸèƒ½å¼€å‘æ–‡æ¡£.md** - æœ¬æ–‡æ¡£

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. æ‹–æ”¾äº¤äº’
- [x] æ‹–æ”¾åŒºåŸŸè§†è§‰åé¦ˆ
- [x] æ‹–æ”¾æ‚¬åœé«˜äº®æ•ˆæœ
- [x] æ‰¹é‡æ–‡ä»¶æ‹–æ”¾
- [x] æ–‡ä»¶æ ¼å¼è‡ªåŠ¨è¿‡æ»¤

### 2. æ–‡ä»¶ç®¡ç†
- [x] æ–‡ä»¶åˆ—è¡¨å±•ç¤º
- [x] æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤ºï¼ˆåç§°ã€å¤§å°ã€è·¯å¾„ï¼‰
- [x] å•ä¸ªæ–‡ä»¶åˆ é™¤
- [x] æ‰¹é‡æ¸…ç©ºæ–‡ä»¶
- [x] æ–‡ä»¶å¤§å°æ ¼å¼åŒ–

### 3. å¯¼å…¥åŠŸèƒ½
- [x] ç›®æ ‡æ–‡ä»¶å¤¹é€‰æ‹©
- [x] æ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡ä½ç½®
- [x] é‡åæ–‡ä»¶è‡ªåŠ¨é‡å‘½å
- [x] å¯¼å…¥è¿›åº¦æ˜¾ç¤º
- [x] å¯¼å…¥ç»“æœç»Ÿè®¡

### 4. é”™è¯¯å¤„ç†
- [x] æ–‡ä»¶ä¸å­˜åœ¨æ£€æµ‹
- [x] æƒé™é”™è¯¯æç¤º
- [x] ç£ç›˜ç©ºé—´æ£€æŸ¥
- [x] è¯¦ç»†é”™è¯¯ä¿¡æ¯å±•ç¤º

### 5. UI/UX
- [x] æ·±è‰²ä¸»é¢˜é€‚é…
- [x] å“åº”å¼å¸ƒå±€
- [x] åŠ¨ç”»è¿‡æ¸¡æ•ˆæœ
- [x] åŠ è½½çŠ¶æ€æç¤º
- [x] æˆåŠŸ/å¤±è´¥æ¶ˆæ¯åé¦ˆ

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### æ‹–æ”¾äº‹ä»¶å¤„ç†

```typescript
// 1. ç›‘å¬æ‹–æ”¾äº‹ä»¶
onDragOver={handleDragOver}   // æ‹–æ”¾æ‚¬åœ
onDragLeave={handleDragLeave} // ç¦»å¼€æ‹–æ”¾åŒº
onDrop={handleDrop}            // é‡Šæ”¾æ–‡ä»¶

// 2. è·å–æ–‡ä»¶åˆ—è¡¨
const files = Array.from(e.dataTransfer.files);

// 3. è¿‡æ»¤å›¾ç‰‡æ–‡ä»¶
const imageFiles = files.filter(file => 
  /\.(jpg|jpeg|png|gif|webp|bmp|svg)$/i.test(file.name)
);

// 4. è·å–æ–‡ä»¶è·¯å¾„ï¼ˆElectron ç‰¹æœ‰ï¼‰
const path = (file as any).path;
```

### IPC é€šä¿¡æµç¨‹

```
æ¸²æŸ“è¿›ç¨‹                     ä¸»è¿›ç¨‹
   â”‚                          â”‚
   â”œâ”€â”€importFiles()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                          â”œâ”€â”€å¤åˆ¶æ–‡ä»¶
   â”‚                          â”œâ”€â”€å¤„ç†é‡å
   â”‚                          â”œâ”€â”€é”™è¯¯å¤„ç†
   â”‚<â”€â”€â”€â”€â”€è¿”å›ç»“æœâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                          â”‚
```

### æ–‡ä»¶é‡å‘½åç®—æ³•

```typescript
function generateUniqueFileName(targetDir, originalName) {
  let counter = 1;
  let newName = originalName;
  
  while (æ–‡ä»¶å­˜åœ¨) {
    newName = `${counter}_${originalName}`;
    counter++;
  }
  
  return newName;
}
```

---

## ğŸ“ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         UI Layer (React)            â”‚
â”‚  - DropZone.tsx (UIç»„ä»¶)            â”‚
â”‚  - useFileDrop.ts (ä¸šåŠ¡é€»è¾‘)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ IPC é€šä¿¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      IPC Bridge (Preload)           â”‚
â”‚  - preload.ts (APIæš´éœ²)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ contextBridge
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Main Process (Electron)          â”‚
â”‚  - ipc-handlers.ts (æ–‡ä»¶æ“ä½œ)       â”‚
â”‚  - main.ts (è¿›ç¨‹ç®¡ç†)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Node.js API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       File System (fs-extra)        â”‚
â”‚  - æ–‡ä»¶å¤åˆ¶ã€åˆ é™¤ã€é‡å‘½å            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
ç”¨æˆ·æ‹–æ”¾æ–‡ä»¶
   â†“
useFileDrop Hook å¤„ç†
   â†“
æ›´æ–° React çŠ¶æ€ (droppedFiles)
   â†“
ç”¨æˆ·ç‚¹å‡»å¯¼å…¥
   â†“
è°ƒç”¨ electronAPI.importFiles()
   â†“
IPC é€šä¿¡åˆ°ä¸»è¿›ç¨‹
   â†“
ipc-handlers å¤„ç†æ–‡ä»¶æ“ä½œ
   â†“
è¿”å› ImportResult
   â†“
æ›´æ–° UI æ˜¾ç¤ºç»“æœ
```

---

## ğŸ¨ UI ç»„ä»¶ç»“æ„

```
DropZone
â”œâ”€â”€ æ‹–æ”¾åŒºåŸŸ (Card)
â”‚   â”œâ”€â”€ å›¾æ ‡ (InboxOutlined)
â”‚   â”œâ”€â”€ æ ‡é¢˜
â”‚   â””â”€â”€ æç¤ºæ–‡å­—
â”œâ”€â”€ ç›®æ ‡æ–‡ä»¶å¤¹é€‰æ‹© (Card)
â”‚   â”œâ”€â”€ è·¯å¾„è¾“å…¥æ¡† (Input)
â”‚   â””â”€â”€ é€‰æ‹©æŒ‰é’® (Button)
â”œâ”€â”€ æ–‡ä»¶åˆ—è¡¨ (Card + List)
â”‚   â”œâ”€â”€ åˆ—è¡¨å¤´éƒ¨
â”‚   â”‚   â”œâ”€â”€ æ ‡é¢˜
â”‚   â”‚   â””â”€â”€ æ¸…ç©ºæŒ‰é’®
â”‚   â””â”€â”€ æ–‡ä»¶é¡¹ (List.Item)
â”‚       â”œâ”€â”€ å›¾æ ‡
â”‚       â”œâ”€â”€ æ–‡ä»¶å + æ ‡ç­¾
â”‚       â”œâ”€â”€ æ–‡ä»¶ä¿¡æ¯
â”‚       â””â”€â”€ åˆ é™¤æŒ‰é’®
â”œâ”€â”€ å¯¼å…¥è¿›åº¦ (Card + Progress)
â”‚   â”œâ”€â”€ æç¤ºæ–‡å­—
â”‚   â””â”€â”€ è¿›åº¦æ¡
â””â”€â”€ å¯¼å…¥æŒ‰é’® (Button)
```

---

## ğŸ” å®‰å…¨è€ƒè™‘

### 1. æ–‡ä»¶è·¯å¾„éªŒè¯
```typescript
// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if (!await fs.pathExists(filePath)) {
  return error;
}
```

### 2. æƒé™æ£€æŸ¥
```typescript
// ç¡®ä¿ç›®æ ‡ç›®å½•å­˜åœ¨ä¸”å¯å†™
await fs.ensureDir(targetFolder);
```

### 3. æ–‡ä»¶ç±»å‹éªŒè¯
```typescript
// åªæ¥å—ç‰¹å®šå›¾ç‰‡æ ¼å¼
const SUPPORTED_EXTENSIONS = ['jpg', 'jpeg', 'png', ...];
```

### 4. ä¸Šä¸‹æ–‡éš”ç¦»
```typescript
// preload.ts ä½¿ç”¨ contextBridge
contextBridge.exposeInMainWorld('electronAPI', api);
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. æ‰¹é‡å¤„ç†
- ä½¿ç”¨ `Promise.all()` å¹¶è¡Œå¤„ç†å¤šä¸ªæ–‡ä»¶
- é¿å…é˜»å¡ä¸»çº¿ç¨‹

### 2. å†…å­˜ç®¡ç†
- ä¸åœ¨å†…å­˜ä¸­åŠ è½½æ•´ä¸ªæ–‡ä»¶å†…å®¹
- ä½¿ç”¨æµå¼å¤åˆ¶ï¼ˆ`fs.copy()`ï¼‰

### 3. UI å“åº”
- ä½¿ç”¨ `useCallback` é¿å…é‡å¤æ¸²æŸ“
- è¿›åº¦æ¡ä½¿ç”¨é˜²æŠ–æ›´æ–°

### 4. æ–‡ä»¶éªŒè¯
- åœ¨æ¸²æŸ“è¿›ç¨‹å…ˆè¿‡æ»¤æ–‡ä»¶ç±»å‹
- å‡å°‘ IPC é€šä¿¡æ¬¡æ•°

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•
```typescript
// useFileDrop.test.ts
describe('useFileDrop', () => {
  it('åº”è¯¥è¿‡æ»¤éå›¾ç‰‡æ–‡ä»¶', () => {
    // æµ‹è¯•é€»è¾‘
  });
});
```

### é›†æˆæµ‹è¯•
```typescript
// DropZone.test.tsx
describe('DropZone Component', () => {
  it('åº”è¯¥æ˜¾ç¤ºæ‹–æ”¾çš„æ–‡ä»¶', () => {
    // æµ‹è¯•é€»è¾‘
  });
});
```

### E2E æµ‹è¯•
```typescript
// e2e/drag-drop.spec.ts
test('å®Œæ•´çš„æ‹–æ”¾å¯¼å…¥æµç¨‹', async ({ page }) => {
  // æµ‹è¯•é€»è¾‘
});
```

---

## ğŸ› å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

### å½“å‰é™åˆ¶
1. ä¸æ”¯æŒæ‹–æ”¾æ–‡ä»¶å¤¹ï¼ˆåªæ”¯æŒæ–‡ä»¶ï¼‰
2. ä¸æ”¯æŒå›¾ç‰‡é¢„è§ˆ
3. æ²¡æœ‰å¯¼å…¥å†å²è®°å½•
4. æ²¡æœ‰è¿›åº¦æš‚åœ/å–æ¶ˆåŠŸèƒ½

### å·²çŸ¥é—®é¢˜
- æ— é‡å¤§å·²çŸ¥é—®é¢˜

### æœªæ¥æ”¹è¿›
- [ ] æ·»åŠ å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
- [ ] æ”¯æŒæ‹–æ”¾æ–‡ä»¶å¤¹
- [ ] æ·»åŠ å¯¼å…¥å†å²
- [ ] è‡ªå®šä¹‰é‡å‘½åè§„åˆ™
- [ ] å‹ç¼©åŒ…è§£å‹å¯¼å…¥
- [ ] äº‘ç«¯å­˜å‚¨é›†æˆ
- [ ] æ‹–æ”¾æ’¤é”€åŠŸèƒ½

---

## ğŸ“– API æ–‡æ¡£

### electronAPI.importFiles()

å¯¼å…¥æ–‡ä»¶åˆ°ç›®æ ‡æ–‡ä»¶å¤¹ã€‚

**ç­¾åï¼š**
```typescript
importFiles(files: string[], targetFolder: string): Promise<ImportResult>
```

**å‚æ•°ï¼š**
- `files` - æºæ–‡ä»¶è·¯å¾„æ•°ç»„
- `targetFolder` - ç›®æ ‡æ–‡ä»¶å¤¹è·¯å¾„

**è¿”å›ï¼š**
```typescript
{
  success: string[],      // æˆåŠŸå¯¼å…¥çš„æ–‡ä»¶å
  failed: Array<{         // å¤±è´¥çš„æ–‡ä»¶ä¿¡æ¯
    file: string,
    error: string
  }>
}
```

**ç¤ºä¾‹ï¼š**
```typescript
const result = await window.electronAPI.importFiles(
  ['/path/to/image1.jpg', '/path/to/image2.png'],
  '/target/folder'
);

console.log(result.success); // ['image1.jpg', '1_image2.png']
```

---

### electronAPI.selectFolder()

æ‰“å¼€æ–‡ä»¶å¤¹é€‰æ‹©å¯¹è¯æ¡†ã€‚

**ç­¾åï¼š**
```typescript
selectFolder(): Promise<string | null>
```

**è¿”å›ï¼š**
- é€‰ä¸­çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œæˆ– `null`ï¼ˆç”¨æˆ·å–æ¶ˆï¼‰

**ç¤ºä¾‹ï¼š**
```typescript
const folder = await window.electronAPI.selectFolder();
if (folder) {
  console.log('é€‰ä¸­çš„æ–‡ä»¶å¤¹:', folder);
}
```

---

### electronAPI.listFiles()

åˆ—å‡ºæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚

**ç­¾åï¼š**
```typescript
listFiles(folder: string): Promise<FileInfo[]>
```

**å‚æ•°ï¼š**
- `folder` - æ–‡ä»¶å¤¹è·¯å¾„

**è¿”å›ï¼š**
```typescript
[
  {
    name: string,
    path: string,
    size: number,
    createTime?: Date,
    modifyTime?: Date
  }
]
```

---

## ğŸ’¡ å¼€å‘æŠ€å·§

### 1. è°ƒè¯• IPC é€šä¿¡

åœ¨ä¸»è¿›ç¨‹ä¸­æ·»åŠ æ—¥å¿—ï¼š
```typescript
ipcMain.handle('import-files', async (event, files, targetFolder) => {
  console.log('æ”¶åˆ°å¯¼å…¥è¯·æ±‚:', { files, targetFolder });
  // ...
});
```

### 2. è°ƒè¯•æ‹–æ”¾äº‹ä»¶

åœ¨ç»„ä»¶ä¸­æ·»åŠ æ—¥å¿—ï¼š
```typescript
const handleDrop = (e: React.DragEvent) => {
  console.log('æ‹–æ”¾çš„æ–‡ä»¶:', e.dataTransfer.files);
  // ...
};
```

### 3. æŸ¥çœ‹æ–‡ä»¶è·¯å¾„

åœ¨å¼€å‘è€…å·¥å…·ä¸­ï¼š
```javascript
console.log('æ–‡ä»¶è·¯å¾„:', (file as any).path);
```

---

## ğŸ“ å­¦ä¹ èµ„æº

### Electron
- [Electron å®˜æ–¹æ–‡æ¡£](https://www.electronjs.org/docs)
- [IPC é€šä¿¡æŒ‡å—](https://www.electronjs.org/docs/latest/tutorial/ipc)
- [contextBridge API](https://www.electronjs.org/docs/latest/api/context-bridge)

### React
- [React Hooks](https://react.dev/reference/react)
- [æ‹–æ”¾ API](https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_Drag_and_Drop_API)

### Ant Design
- [Ant Design ç»„ä»¶åº“](https://ant.design/components/overview-cn)

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ
1. æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. é˜…è¯» `æµ‹è¯•æŒ‡å—.md`
3. æŸ¥çœ‹ `ä½¿ç”¨è¯´æ˜.md`
4. è”ç³»å¼€å‘å›¢é˜Ÿ

---

**å¼€å‘å®Œæˆæ—¥æœŸï¼š** 2024-12-17  
**ç‰ˆæœ¬ï¼š** 1.0.0  
**å¼€å‘è€…ï¼š** AI Assistant

