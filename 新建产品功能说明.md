# 新建产品功能说明

## ✅ 已完成的功能

### 1. 新建产品对话框

**位置**: 工具栏右上角 "新建产品" 按钮

**功能**:
- ✅ 产品类型选择（预设：CD-卡片、ST-贴纸）
- ✅ 自定义产品类型（支持用户输入自定义缩写）
- ✅ 是否有刀模源文件选择（HasOrigin / NoOrigin）
- ✅ 产品规格输入（如：6pcs、50pcs、A4size）
- ✅ 英文标题输入（只允许字母、数字、空格、下划线、中划线）
- ✅ 中文标题输入（最多30个字符）
- ✅ 实时预览生成的文件夹名称

### 2. 产品文件夹命名规则

**格式**: `{类型}{序号}_{日期}_{源文件}_{规格}_{英文名}_{中文名}`

**示例**: `CD001_20251217_NoOrigin_6pcs_Candle_蜡烛贴纸`

**说明**:
- **类型**: CD（卡片）、ST（贴纸）等，可自定义
- **序号**: 000-999 三位数字，全局唯一（跨所有状态目录）
- **日期**: YYYYMMDD 格式，自动生成
- **源文件**: HasOrigin（有刀模）/ NoOrigin（无刀模）
- **规格**: 用户输入，如 6pcs、50pcs
- **英文名**: 产品英文名称
- **中文名**: 产品中文名称

### 3. 自动序号管理

**智能递增**:
- ✅ 扫描所有状态目录（01_In_Progress、02_Listing、03_Waiting、04_Active、05_Archive）
- ✅ 按产品类型独立计数（CD001、CD002... / ST001、ST002...）
- ✅ 找出同类型最大序号，自动 +1
- ✅ 确保序号全局唯一

**跨目录扫描示例**:
```
02_Listing/CD001_...  -> CD最大序号: 001
04_Active/CD003_...   -> CD最大序号: 003
05_Archive/CD002_...  -> 已考虑
新建 CD 类产品 -> 自动分配 CD004
```

### 4. 标准文件夹结构

每个新建的产品文件夹自动包含：

```
CD001_20251217_NoOrigin_6pcs_Candle_蜡烛贴纸/
├─ 01_Ref_Images/          (参考图片)
├─ 02_Ai_Raw/              (AI生成原图)
├─ 03_AI_Handle/           (AI处理后图片)
├─ 04_Final_Goods_Images/  (最终成品)
└─ GoodsInfo.md            (产品信息文档)
```

### 5. GoodsInfo.md 模板

自动生成的产品信息文档包含：
- 产品信息（类型、规格、是否有源文件、创建日期）
- 参考链接区域
- 提示词 (Prompt) 区域
- 尺寸规格区域
- 备注区域

### 6. 工作区初始化功能

**自动检测**:
- ✅ 打开文件夹后自动检测是否为标准 Temu 工作区
- ✅ 如果不是，弹出初始化对话框

**一键初始化**:
- ✅ 创建 6 个标准分类目录
- ✅ 创建公共素材库子文件夹
- ✅ 创建产品模板文件夹（CD000_模版）
- ✅ 生成 README.md 工作区说明文档

**标准目录结构**:
```
TemuWorkspace/
├─ 00_Assets/              (公共素材库)
│  ├─ Brand_Logo/
│  ├─ Common_Template/
│  └─ ComfyUI_Workflows/
├─ 01_In_Progress/         (选品池/初筛)
├─ 02_Listing/             (制作中/正在处理)
│  └─ CD000_20250101_Template_卡片_模版/  (模板)
├─ 03_Waiting/             (已发货，未到仓库)
├─ 04_Active/              (已上架/热卖中)
└─ 05_Archive/             (已下架/淘汰/历史)
```

---

## 🎯 使用流程

### 步骤 1: 打开工作区文件夹
1. 点击左上角 "打开文件夹" 按钮
2. 选择您的 Temu 工作区文件夹
3. 如果不是标准工作区，会提示是否初始化

### 步骤 2: 新建产品
1. 点击工具栏 "新建产品" 按钮
2. 填写产品信息：
   - 选择或自定义产品类型
   - 选择是否有刀模源文件
   - 输入产品规格（如：6pcs）
   - 输入英文标题（如：Candle）
   - 输入中文标题（如：蜡烛贴纸）
3. 点击 "创建" 按钮
4. 系统自动：
   - 生成唯一序号
   - 创建标准文件夹结构
   - 生成 GoodsInfo.md 文档

### 步骤 3: 处理产品图片
1. 将参考图放入 `01_Ref_Images/`
2. AI 生成的图片放入 `02_Ai_Raw/`
3. ComfyUI 处理后的图片放入 `03_AI_Handle/`
4. 最终成品放入 `04_Final_Goods_Images/`
5. 在 `GoodsInfo.md` 中记录详细信息

---

## 🔧 技术实现

### 核心文件

1. **NewProductDialog.tsx** - 新建产品对话框组件
2. **WorkspaceInitDialog.tsx** - 工作区初始化对话框
3. **workspaceInit.ts** - 工作区初始化工具函数
4. **ipc-handlers.ts** - Electron IPC 处理器（文件系统操作）

### 关键函数

- `createProductFolder()` - 创建产品文件夹
- `getNextSerialNumber()` - 获取下一个序号（跨目录扫描）
- `isStandardWorkspace()` - 检查是否为标准工作区
- `initWorkspace()` - 初始化标准工作区结构

---

## 📝 注意事项

1. **序号全局唯一**: 序号在所有状态目录中全局唯一，按类型独立计数
2. **命名规范**: 英文名和规格只允许字母、数字、下划线、中划线
3. **中文标题长度**: 中文标题最多 30 个字符
4. **文件夹移动**: 产品在不同状态间移动时，保持原有序号不变
5. **自动备份**: 建议定期备份整个工作区

---

## 🚀 下一步计划

可考虑的扩展功能：
- [ ] 产品文件夹批量导入
- [ ] 产品状态管理（自动移动到不同分类）
- [ ] 工作区统计面板（产品数量、类型分布）
- [ ] 产品模板管理（保存自定义模板）
- [ ] 文件夹快速复制功能

---

**创建日期**: 2025-12-17
**版本**: 1.0.0

