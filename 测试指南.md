# 文件拖放功能测试指南

## 🧪 测试前准备

### 1. 启动应用

```bash
npm run dev
```

等待 Electron 窗口打开。

### 2. 准备测试文件

在桌面或任意位置准备一些测试图片：
- `test1.jpg`
- `test2.png`
- `test3.gif`
- `test4.webp`

## ✅ 功能测试清单

### 测试1：基本拖放功能

**步骤：**
1. 点击左侧菜单 **"文件导入"**
2. 从文件管理器拖动一个 `.jpg` 图片到拖放区域
3. 观察拖放区域的视觉反馈

**预期结果：**
- ✅ 拖动时，区域边框变蓝色，背景变浅蓝色
- ✅ 显示 "松开鼠标放置文件" 提示
- ✅ 释放后文件出现在待导入列表
- ✅ 显示成功提示消息

---

### 测试2：批量拖放

**步骤：**
1. 同时选中多个图片文件（Ctrl+点击）
2. 拖动到拖放区域
3. 释放鼠标

**预期结果：**
- ✅ 所有文件都添加到列表
- ✅ 显示 "已添加 X 个图片文件"
- ✅ 文件列表显示正确的文件信息

---

### 测试3：文件格式过滤

**步骤：**
1. 准备一些非图片文件（.txt, .pdf, .docx）
2. 和图片文件一起拖放到区域
3. 观察结果

**预期结果：**
- ✅ 只有图片文件被添加
- ✅ 显示 "只支持图片文件" 警告
- ✅ 非图片文件被自动过滤

---

### 测试4：文件列表操作

**步骤：**
1. 拖放 3-5 个文件到列表
2. 点击某个文件的删除按钮
3. 点击 "清空列表" 按钮

**预期结果：**
- ✅ 单个文件被移除
- ✅ 文件数量更新
- ✅ 清空按钮清空所有文件

---

### 测试5：选择目标文件夹

**步骤：**
1. 点击 "选择文件夹" 按钮
2. 在弹出的对话框中选择一个文件夹
3. 点击 "选择"

**预期结果：**
- ✅ 文件夹路径显示在输入框中
- ✅ 显示 "已选择文件夹" 成功消息
- ✅ 导入按钮变为可用状态

---

### 测试6：文件导入功能

**步骤：**
1. 拖放几个文件到列表
2. 选择目标文件夹
3. 点击 "导入 X 个文件" 按钮
4. 等待导入完成

**预期结果：**
- ✅ 显示进度条
- ✅ 进度条从 0% 到 100%
- ✅ 显示成功消息
- ✅ 弹出导入结果对话框
- ✅ 文件列表自动清空

---

### 测试7：重名文件处理

**步骤：**
1. 创建测试文件 `duplicate.jpg`
2. 选择目标文件夹（已包含 `duplicate.jpg`）
3. 导入文件

**预期结果：**
- ✅ 文件成功导入
- ✅ 新文件名为 `1_duplicate.jpg`
- ✅ 原文件未被覆盖

再次导入相同文件：
- ✅ 新文件名为 `2_duplicate.jpg`

---

### 测试8：导入失败处理

**步骤：**
1. 选择一个没有写入权限的目标文件夹
2. 尝试导入文件

**预期结果：**
- ✅ 显示错误消息
- ✅ 导入结果显示失败列表
- ✅ 显示具体错误原因

---

### 测试9：大文件处理

**步骤：**
1. 准备一个较大的图片文件（>10MB）
2. 拖放并导入

**预期结果：**
- ✅ 文件大小正确显示（MB单位）
- ✅ 可以正常导入
- ✅ 进度显示正常

---

### 测试10：界面响应性

**步骤：**
1. 快速切换不同菜单页面
2. 在文件导入页面和其他页面间切换
3. 导入过程中切换页面

**预期结果：**
- ✅ 页面切换流畅
- ✅ 状态保持正确
- ✅ 没有内存泄漏

---

## 🔍 开发者工具检查

在开发环境中，打开开发者工具（自动打开）：

### 1. 控制台（Console）

**检查点：**
- ❌ 无错误信息（红色）
- ⚠️ 警告信息（黄色）应该合理
- ✅ IPC 通信日志正常

### 2. 网络（Network）

**检查点：**
- ✅ 资源加载成功
- ✅ 无 404 错误

### 3. 性能（Performance）

**检查点：**
- ✅ 拖放操作响应快速（<100ms）
- ✅ 文件列表渲染流畅
- ✅ 内存使用稳定

---

## 🐛 已知问题排查

### 问题1：拖放无反应

**排查步骤：**
1. 检查控制台错误
2. 确认 `useFileDrop` Hook 是否正常工作
3. 验证事件监听器是否绑定

**解决方法：**
```typescript
// 在 DropZone.tsx 中添加调试日志
console.log('Drag over:', e.dataTransfer.files);
```

---

### 问题2：IPC 通信失败

**排查步骤：**
1. 检查 `electron/ipc-handlers.ts` 是否正确注册
2. 验证 `electron/preload.ts` API 是否暴露
3. 查看主进程日志

**解决方法：**
```bash
# 重启应用
npm run dev
```

---

### 问题3：文件导入失败

**排查步骤：**
1. 检查文件路径是否正确
2. 验证目标文件夹权限
3. 查看错误信息

**解决方法：**
- 使用绝对路径
- 选择有写入权限的文件夹

---

## 📊 测试结果记录表

| 测试项 | 状态 | 备注 |
|-------|------|------|
| 基本拖放功能 | ⬜ | |
| 批量拖放 | ⬜ | |
| 文件格式过滤 | ⬜ | |
| 文件列表操作 | ⬜ | |
| 选择目标文件夹 | ⬜ | |
| 文件导入功能 | ⬜ | |
| 重名文件处理 | ⬜ | |
| 导入失败处理 | ⬜ | |
| 大文件处理 | ⬜ | |
| 界面响应性 | ⬜ | |

**状态说明：**
- ⬜ 未测试
- ✅ 通过
- ❌ 失败
- ⚠️ 有问题

---

## 🎯 性能基准

**预期指标：**
- 拖放响应时间：< 100ms
- 文件列表渲染：< 200ms（100个文件）
- 单文件导入时间：< 500ms（10MB文件）
- 批量导入 100 个文件：< 30s
- 内存占用：< 200MB（空闲）

---

## 📝 测试报告模板

```
测试日期：____________________
测试人员：____________________
应用版本：____________________

通过的测试：_____ / 10
失败的测试：_____

详细问题：
1. _______________________________
2. _______________________________
3. _______________________________

建议改进：
1. _______________________________
2. _______________________________
3. _______________________________

总体评价：
□ 优秀  □ 良好  □ 一般  □ 需改进
```

---

## 🚀 自动化测试（未来）

使用 Playwright 或 Spectron 进行自动化测试：

```typescript
// 示例：自动化测试脚本
describe('File Drop Feature', () => {
  it('should accept image files', async () => {
    // 测试代码
  });

  it('should filter non-image files', async () => {
    // 测试代码
  });
});
```

---

**完成测试后，请填写测试报告并提交！**

